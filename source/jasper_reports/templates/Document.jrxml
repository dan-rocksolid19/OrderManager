<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Document" language="groovy" pageWidth="612" pageHeight="792" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="fc6ea049-2380-4767-b84c-300750c0cf47">
	<property name="ireport.zoom" value="1.3310000000000006"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="17"/>
	<parameter name="doc_type" class="java.lang.String"/>
	<parameter name="document_id" class="java.lang.Long"/>
	<queryString>
		<![CDATA[SELECT 
    d.id as document_id,
    d.doc_type,
    d.created_at,
    d.status,
    c.customer_name,
    c.company_name,
    c.phone_number,
    c.email,
    (SELECT CONCAT_WS(chr(10),
             CASE 
                 WHEN o.companyname IS NOT NULL AND o.companyname != '' 
                 THEN o.companyname 
                 ELSE o.orgname 
             END,
             oa.streetone,
             CASE WHEN oa.streettwo IS NOT NULL AND oa.streettwo != '' THEN oa.streettwo END,
             concat_ws(' ', concat_ws(', ', nullif(oa.txtcity,''), nullif(oa.txtstate,'')), nullif(oa.txtzip,'')),
             CASE WHEN o.phone1 IS NOT NULL AND o.phone1 != '' THEN CONCAT('Phone: ', o.phone1) END,
             CASE WHEN o.fax1 IS NOT NULL AND o.fax1 != '' THEN CONCAT('Fax: ', o.fax1) END,
             CASE WHEN o.email IS NOT NULL AND o.email != '' THEN CONCAT('Email: ', o.email) END
         )
       FROM public.org o
       LEFT JOIN public.org_address oa ON oa.orgid = o.org_id AND oa.addresstype = 'BILLTO'
       WHERE o.orgdiscriminator = 'COMP'
       LIMIT 1
    ) as comp_name_addr,
    CONCAT_WS(chr(10),
        CASE 
            WHEN c.company_name IS NOT NULL AND c.company_name != '' 
            THEN c.company_name 
            ELSE c.customer_name 
        END,
        CASE 
            WHEN c.company_name IS NOT NULL AND c.company_name != '' AND c.customer_name != c.company_name
            THEN c.customer_name
            ELSE NULL
        END,
        ba.address_line,
        concat_ws(' ', concat_ws(', ', nullif(ba.city,''), nullif(ba.state,'')), nullif(ba.zip_code,''))
    ) AS bill_to_address,
    CONCAT_WS(chr(10),
        sa.address_line,
        concat_ws(' ', concat_ws(', ', nullif(sa.city,''), nullif(sa.state,'')), nullif(sa.zip_code,''))
    ) AS site_location_address,
    COALESCE(d.notes, r.information) AS notes,
    i.item_number,
    i.product_service,
    i.quantity,
    i.unit_price,
    i.total AS item_total
FROM job_manager.documents d
LEFT JOIN job_manager.customers c ON d.customer_id = c.id
LEFT JOIN job_manager.document_addresses da_billing ON d.id = da_billing.document_id AND da_billing.address_type = 'billing'
LEFT JOIN job_manager.addresses ba ON da_billing.address_id = ba.id
LEFT JOIN job_manager.document_addresses da_site ON d.id = da_site.document_id AND da_site.address_type = 'service'
LEFT JOIN job_manager.addresses sa ON da_site.address_id = sa.id
LEFT JOIN job_manager.quotes q ON d.id = q.document_id
LEFT JOIN job_manager.requests r ON d.id = r.document_id
LEFT JOIN job_manager.items i ON i.document_id = d.id
WHERE d.id = $P{document_id}]]>
	</queryString>
	<field name="document_id" class="java.lang.Long"/>
	<field name="doc_type" class="java.lang.String"/>
	<field name="created_at" class="java.sql.Timestamp"/>
	<field name="status" class="java.lang.String"/>
	<field name="customer_name" class="java.lang.String"/>
	<field name="company_name" class="java.lang.String"/>
	<field name="phone_number" class="java.lang.String"/>
	<field name="email" class="java.lang.String"/>
	<field name="bill_to_address" class="java.lang.String"/>
	<field name="site_location_address" class="java.lang.String"/>
	<field name="comp_name_addr" class="java.lang.String"/>
	<field name="notes" class="java.lang.String"/>
	<field name="item_number" class="java.lang.String"/>
	<field name="product_service" class="java.lang.String"/>
	<field name="quantity" class="java.lang.Integer"/>
	<field name="unit_price" class="java.math.BigDecimal"/>
	<field name="item_total" class="java.math.BigDecimal"/>
	<variable name="TotalSum" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{item_total}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="200" splitType="Stretch">
			<frame>
				<reportElement key="CompanyInfo" x="24" y="10" width="252" height="90" uuid="a1b2c3d4-e5f6-7890-abcd-1234567890ab"/>
				<textField>
					<reportElement x="6" y="4" width="246" height="78" uuid="b2c3d4e5-f678-9012-bcde-2345678901bc"/>
					<textElement>
						<font fontName="DejaVu Sans"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{comp_name_addr}]]></textFieldExpression>
				</textField>
			</frame>
			<textField>
				<reportElement x="355" y="0" width="217" height="39" forecolor="#666666" uuid="c56a6734-079c-4121-8fe0-1c1652ec844c"/>
				<textElement textAlignment="Center" verticalAlignment="Bottom" markup="none">
					<font fontName="DejaVu Sans" size="28" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{doc_type}]]></textFieldExpression>
			</textField>
			<frame>
				<reportElement key="QuoteInfo" x="355" y="50" width="217" height="40" uuid="11111111-1111-1111-1111-111111111111"/>
				<box>
					<topPen lineWidth="0.5" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineColor="#000000"/>
				</box>
				<staticText>
					<reportElement x="0" y="0" width="108" height="20" forecolor="#000000" backcolor="#E6E6E6" mode="Opaque" uuid="22222222-2222-2222-2222-222222222222"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font fontName="DejaVu Sans" size="10" isBold="true"/>
					</textElement>
					<text><![CDATA[RC Number]]></text>
				</staticText>
				<staticText>
					<reportElement x="108" y="0" width="109" height="20" forecolor="#000000" backcolor="#E6E6E6" mode="Opaque" uuid="33333333-3333-3333-3333-333333333333"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font fontName="DejaVu Sans" size="10" isBold="true"/>
					</textElement>
					<text><![CDATA[Date]]></text>
				</staticText>
				<textField pattern="" isBlankWhenNull="true">
					<reportElement x="0" y="20" width="108" height="20" forecolor="#000000" uuid="44444444-4444-4444-4444-444444444444"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font fontName="DejaVu Sans" size="10"/>
					</textElement>
					<textFieldExpression><![CDATA["RC " + $F{document_id}]]></textFieldExpression>
				</textField>
				<textField pattern="MM/dd/yy" isBlankWhenNull="true">
					<reportElement x="108" y="20" width="109" height="20" forecolor="#000000" uuid="55555555-5555-5555-5555-555555555555"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font fontName="DejaVu Sans" size="10"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{created_at}]]></textFieldExpression>
				</textField>
				<line>
					<reportElement x="108" y="0" width="0" height="40" uuid="66666666-6666-6666-6666-666666666666"/>
					<graphicElement>
						<pen lineWidth="0.5" lineColor="#000000"/>
					</graphicElement>
				</line>
				<line>
					<reportElement x="0" y="20" width="217" height="0" uuid="77777777-7777-7777-7777-777777777777"/>
					<graphicElement>
						<pen lineWidth="0.5" lineColor="#000000"/>
					</graphicElement>
				</line>
			</frame>
			<frame>
				<reportElement key="BillTo" x="24" y="120" width="252" height="75" uuid="f657583a-9765-4cfa-b60c-d5509fbe05f7"/>
				<staticText>
					<reportElement key="staticText" x="0" y="0" width="49" height="15" forecolor="#000000" uuid="9c01164c-f0f9-4c79-84b7-379302f4f221"/>
					<textElement verticalAlignment="Top">
						<font fontName="DejaVu Sans" size="10" isBold="true"/>
					</textElement>
					<text><![CDATA[Bill To:]]></text>
				</staticText>
				<textField pattern="" isBlankWhenNull="true">
					<reportElement key="textField" x="2" y="17" width="250" height="58" forecolor="#000000" uuid="6d2bdc25-fc65-40c5-96f5-39f8cb9b498f"/>
					<box topPadding="2" leftPadding="3" bottomPadding="2" rightPadding="3">
						<pen lineWidth="0.5"/>
						<topPen lineWidth="0.5" lineColor="#000000"/>
						<leftPen lineWidth="0.5" lineColor="#000000"/>
						<bottomPen lineWidth="0.5" lineColor="#000000"/>
						<rightPen lineWidth="0.5" lineColor="#000000"/>
					</box>
					<textElement verticalAlignment="Top">
						<font fontName="DejaVu Sans" size="10"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{bill_to_address}]]></textFieldExpression>
				</textField>
			</frame>
			<frame>
				<reportElement key="SiteLocation" x="320" y="120" width="252" height="75" uuid="a8b9c0d1-e2f3-4567-890a-bcdef1234567"/>
				<staticText>
					<reportElement key="staticText" x="0" y="0" width="80" height="15" forecolor="#000000" uuid="b9c0d1e2-f345-6789-01ab-cdef23456789"/>
					<textElement verticalAlignment="Top">
						<font fontName="DejaVu Sans" size="10" isBold="true"/>
					</textElement>
					<text><![CDATA[Site Location:]]></text>
				</staticText>
				<textField pattern="" isBlankWhenNull="true">
					<reportElement key="textField" x="2" y="17" width="250" height="58" forecolor="#000000" uuid="c0d1e2f3-4567-890a-bcde-f234567890ab"/>
					<box topPadding="2" leftPadding="3" bottomPadding="2" rightPadding="3">
						<pen lineWidth="0.5"/>
						<topPen lineWidth="0.5" lineColor="#000000"/>
						<leftPen lineWidth="0.5" lineColor="#000000"/>
						<bottomPen lineWidth="0.5" lineColor="#000000"/>
						<rightPen lineWidth="0.5" lineColor="#000000"/>
					</box>
					<textElement verticalAlignment="Top">
						<font fontName="DejaVu Sans" size="10"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{site_location_address}]]></textFieldExpression>
				</textField>
			</frame>
		</band>
	</title>
	<pageHeader>
		<band height="35" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="20" splitType="Stretch">
			<staticText>
				<reportElement x="24" y="0" width="50" height="20" backcolor="#E6E6E6" mode="Opaque" uuid="0f1e2d3c-4b5a-6789-0123-456789abcdef"/>
				<box topPadding="2" leftPadding="3" bottomPadding="2" rightPadding="3">
					<topPen lineWidth="0.5" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Qty]]></text>
			</staticText>
			<staticText>
				<reportElement x="74" y="0" width="300" height="20" backcolor="#E6E6E6" mode="Opaque" uuid="1a2b3c4d-5e6f-7890-1234-56789abcdef0"/>
				<box topPadding="2" leftPadding="3" bottomPadding="2" rightPadding="3">
					<topPen lineWidth="0.5" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Item Description]]></text>
			</staticText>
			<staticText>
				<reportElement x="374" y="0" width="90" height="20" backcolor="#E6E6E6" mode="Opaque" uuid="2b3c4d5e-6f70-8912-3456-789abcdef012"/>
				<box topPadding="2" leftPadding="3" bottomPadding="2" rightPadding="3">
					<topPen lineWidth="0.5" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Rate]]></text>
			</staticText>
			<staticText>
				<reportElement x="464" y="0" width="90" height="20" backcolor="#E6E6E6" mode="Opaque" uuid="3c4d5e6f-7081-9234-5678-9abcdef01234"/>
				<box topPadding="2" leftPadding="3" bottomPadding="2" rightPadding="3">
					<topPen lineWidth="0.5" lineColor="#000000"/>
					<leftPen lineWidth="0.5" lineColor="#000000"/>
					<bottomPen lineWidth="0.5" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Amount]]></text>
			</staticText>
			<line>
				<reportElement x="24" y="19" width="530" height="0" uuid="4d5e6f70-8192-3456-789a-bcdef0123456"/>
				<graphicElement>
					<pen lineWidth="0.5" lineColor="#000000"/>
				</graphicElement>
			</line>
		</band>
	</columnHeader>
	<detail>
		<band height="18" splitType="Stretch">
			<textField>
				<reportElement x="24" y="0" width="50" height="18" uuid="5e6f7081-92a3-4567-89bc-def012345678"/>
				<box topPadding="2" leftPadding="3" bottomPadding="2" rightPadding="3">
					<leftPen lineWidth="0.5" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{quantity}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="74" y="0" width="300" height="18" uuid="6f708192-a3b4-5678-9cde-f0123456789a"/>
				<box topPadding="2" leftPadding="3" bottomPadding="2" rightPadding="3">
					<leftPen lineWidth="0.5" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{product_service}]]></textFieldExpression>
			</textField>
			<textField pattern="$#,##0.00">
				<reportElement x="374" y="0" width="90" height="18" uuid="708192a3-b4c5-6789-def0-123456789abc"/>
				<box topPadding="2" leftPadding="3" bottomPadding="2" rightPadding="3">
					<leftPen lineWidth="0.5" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{unit_price}]]></textFieldExpression>
			</textField>
			<textField pattern="$#,##0.00">
				<reportElement x="464" y="0" width="90" height="18" uuid="8192a3b4-c567-89de-f012-3456789abcd"/>
				<box topPadding="2" leftPadding="3" bottomPadding="2" rightPadding="3">
					<leftPen lineWidth="0.5" lineColor="#000000"/>
					<rightPen lineWidth="0.5" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{item_total}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="0" splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="0" splitType="Stretch"/>
	</pageFooter>
	<lastPageFooter>
		<band height="120" splitType="Stretch">
			<staticText>
				<reportElement x="200" y="20" width="150" height="20" uuid="92a3b4c5-d678-90ef-1234-56789abcdef0">
					<printWhenExpression><![CDATA[$P{doc_type}.equals("Quote")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="14" isBold="true"/>
				</textElement>
				<text><![CDATA[Accept Quote:]]></text>
			</staticText>
			<staticText>
				<reportElement x="147" y="58" width="250" height="15" uuid="a3b4c5d6-e789-01f2-3456-789abcdef012">
					<printWhenExpression><![CDATA[$P{doc_type}.equals("Quote")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Signature:______________________________]]></text>
			</staticText>
			<staticText>
				<reportElement x="24" y="85" width="120" height="25" uuid="c5d6e7f8-9012-3a45-6789-abcdef012345"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="16" isBold="true"/>
				</textElement>
				<text><![CDATA[Thank You!]]></text>
			</staticText>
		</band>
	</lastPageFooter>
	<summary>
		<band height="112" splitType="Stretch">
			<line>
				<reportElement x="24" y="0" width="530" height="0" uuid="47d65731-3a3a-4315-b3c7-5b3bcabd673c"/>
				<graphicElement>
					<pen lineWidth="0.5" lineColor="#000000"/>
				</graphicElement>
			</line>
			<staticText>
				<reportElement x="374" y="0" width="90" height="20" uuid="9af4f3b2-1c4d-4f6b-8c16-9965e452d6a7"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Total:]]></text>
			</staticText>
			<textField pattern="$#,##0.00">
				<reportElement x="464" y="0" width="90" height="20" uuid="2b6e70a4-ced6-402e-8f69-de0e6a50560c"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="10" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TotalSum}]]></textFieldExpression>
			</textField>
			<frame>
				<reportElement key="NotesSection" x="24" y="35" width="530" height="70" uuid="d4e5f6a7-b8c9-def0-1234-56789abcdef0"/>
				<staticText>
					<reportElement x="0" y="0" width="50" height="15" forecolor="#000000" uuid="e5f6a7b8-c9de-f012-3456-789abcdef012"/>
					<textElement verticalAlignment="Top">
						<font fontName="DejaVu Sans" size="10" isBold="true"/>
					</textElement>
					<text><![CDATA[Notes:]]></text>
				</staticText>
				<textField isStretchWithOverflow="true" isBlankWhenNull="true">
					<reportElement key="NotesField" x="2" y="17" width="526" height="50" forecolor="#000000" uuid="f6a7b8c9-def0-1234-5678-9abcdef01234"/>
					<box topPadding="3" leftPadding="5" bottomPadding="3" rightPadding="5">
						<pen lineWidth="0.5"/>
						<topPen lineWidth="0.5" lineColor="#000000"/>
						<leftPen lineWidth="0.5" lineColor="#000000"/>
						<bottomPen lineWidth="0.5" lineColor="#000000"/>
						<rightPen lineWidth="0.5" lineColor="#000000"/>
					</box>
					<textElement verticalAlignment="Top">
						<font fontName="DejaVu Sans" size="10"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{notes}]]></textFieldExpression>
				</textField>
			</frame>
		</band>
	</summary>
</jasperReport>
